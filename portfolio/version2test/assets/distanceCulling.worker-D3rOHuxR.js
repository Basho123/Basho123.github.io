(function(){"use strict";self.onmessage=P=>{const b=P.data;if(b.type==="distance"){const{matrices:s,camPos:i,maxDistSq:u,indices:p}=b,m=i[0],z=i[1],M=i[2],r=s.length/16|0,c=p&&p.length>0?p:null,f=c?c.length:r,h=new Uint32Array(f);let a=0;if(c)for(let o=0;o<c.length;o++){const e=c[o];if(e>=r)continue;const d=e*16,g=s[d+12],y=s[d+13],n=s[d+14],t=g-m,l=y-z,x=n-M;t*t+l*l+x*x<u&&(h[a++]=e)}else for(let o=0;o<r;o++){const e=o*16,d=s[e+12],g=s[e+13],y=s[e+14],n=d-m,t=g-z,l=y-M;n*n+t*t+l*l<u&&(h[a++]=o)}self.postMessage(h.subarray(0,a),[h.buffer]);return}if(b.type==="frustum"){const{matrices:s,planes:i,sphereCenterLocal:u,sphereRadius:p,meshHideOffsetY:m,boundsPadding:z,planePadding:M,indices:r}=b,c=s.length/16|0,f=r&&r.length>0?r:null,h=f?f.length:c,a=new Uint32Array(h);let o=0;const e=u[0],d=u[1],g=u[2],y=n=>{const t=n*16,l=Math.hypot(s[t+0],s[t+1],s[t+2]),x=Math.hypot(s[t+4],s[t+5],s[t+6]),L=Math.hypot(s[t+8],s[t+9],s[t+10]),v=s[t+12]+e*l,A=s[t+13]+d*x-m,S=s[t+14]+g*L,U=Math.max(l,x,L),q=p*U+z;for(let w=0;w<6;w++){const C=w*4,D=i[C+0],H=i[C+1],I=i[C+2],O=i[C+3];if(D*v+H*A+I*S+O<-q-M)return!1}return!0};if(f)for(let n=0;n<f.length;n++){const t=f[n];t>=c||y(t)&&(a[o++]=t)}else for(let n=0;n<c;n++)y(n)&&(a[o++]=n);self.postMessage(a.subarray(0,o),[a.buffer])}}})();
